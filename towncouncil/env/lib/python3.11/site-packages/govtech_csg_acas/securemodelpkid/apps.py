from django.apps import AppConfig
from django.db import models

from django.conf import settings
import secrets


def generate_random_id():

    digits = 18  # Maximum length is 18 digits for BigIntegerField id
    chars = '0123456789'
    return int(secrets.choice(chars[1:]) + ''.join(secrets.choice(chars) for i in range(digits - 1)))


class AcasAppConfig(AppConfig):
    default_auto_field = 'django.db.models.AutoField'
    name = 'govtech_csg_acas.securemodelpkid'

    def ready(self):

        models.Model.orig_save = models.Model.save

        # Override the Model.save method to add some custom behavior
        def save_override(self, *args, **kwargs):
            # do some custom behavior before saving
            if hasattr(self, 'id') and not self.id:
                is_unique = False
                while not is_unique:
                    id = generate_random_id()
                    is_unique = not self.__class__.objects.filter(id=id).exists()
                self.id = id

            models.Model.orig_save(self, *args, **kwargs)

        # Modify the Model class to use the overridden save method
        models.Model.save = save_override
